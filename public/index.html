<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ark Wallet</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind with ark color scheme -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        ark: {
                            orange: '#F7931A',
                            dark: '#222222',
                            light: '#F8F9FA',
                            gray: '#6c757d'
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style type="text/tailwindcss">
        /* Custom styles with Tailwind */
        @layer components {
            .card {
                @apply bg-white dark:bg-ark-dark rounded-lg shadow-lg p-6 mb-6;
            }
            .card-header {
                @apply text-xl font-bold mb-4 pb-2 border-b;
            }
            .btn-primary {
                @apply bg-ark-orange hover:bg-amber-600 text-white font-bold py-2 px-4 rounded;
            }
            .btn-secondary {
                @apply bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded;
            }
            .btn-danger {
                @apply bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded;
            }
            .form-input {
                @apply w-full p-2 mb-4 border rounded;
            }
            .alert-info {
                @apply bg-blue-100 text-blue-800 p-4 rounded mb-4;
            }
            .alert-success {
                @apply bg-green-100 text-green-800 p-4 rounded mb-4;
            }
            .alert-warning {
                @apply bg-yellow-100 text-yellow-800 p-4 rounded mb-4;
            }
            .alert-danger {
                @apply bg-red-100 text-red-800 p-4 rounded mb-4;
            }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-white min-h-screen">
    <nav class="bg-white dark:bg-ark-dark shadow-md">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-ark-orange">Ark Wallet</a>
            <div class="flex space-x-2">
                <button id="theme-toggle" class="p-2 rounded text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800">
                    <i class="bi bi-sun-fill dark:hidden"></i>
                    <i class="bi bi-moon-fill hidden dark:inline"></i>
                </button>
                <button class="px-3 py-1 text-sm border border-gray-300 dark:border-gray-700 rounded shadow-sm hover:bg-gray-50 dark:hover:bg-gray-800" id="help-toggle">
                    <i class="bi bi-question-circle"></i> How Ark Works
                </button>
                <button class="px-3 py-1 text-sm text-red-500 border border-red-300 rounded shadow-sm hover:bg-red-50 dark:hover:bg-red-900" id="delete-wallet-btn">
                    <i class="bi bi-trash"></i> Reset Wallet
                </button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8">
        <!-- Wallet Status Alert -->
        <div class="hidden mb-6 alert-info" id="wallet-status-alert">
            <span id="wallet-status-message"></span>
            <button type="button" class="float-right" id="close-status-alert">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>

        <!-- Help Section -->
        <div class="hidden mb-6" id="help-section">
            <div class="card">
                <div class="card-header text-white bg-ark-orange">
                    Understanding the Ark Protocol
                </div>
                <div class="card-body">
                    <h5>What is Ark?</h5>
                    <p><strong>Important:</strong> Ark is a very new Bitcoin Layer 2 protocol. This wallet helps you use Ark without needing to know all the technical details.</p>
                    <p>Ark enables payments without having to create channels first.</p>
                    
                    <h5>Key Concepts</h5>
                    <p class="text-muted mb-2">The wallet will guide you through what actions to take.</p>
                    <ul>
                        <li><strong>VTXOs (Virtual Transaction Outputs)</strong>: Similar to Bitcoin's UTXOs, but they exist off-chain until needed on-chain.</li>
                        <li><strong>Rounds</strong>: Collaborative processes where users can refresh their VTXOs.</li>
                        <li><strong>Expiry Height</strong>: The block height at which a VTXO expires. The closer a VTXO gets to its expiry, the more important it is to refresh it.</li>
                        <li><strong>Refresh</strong>: The process of extending a VTXO's lifetime and possibly changing its type (e.g., from "arkoor" to "round").</li>
                    </ul>
                    
                    <hr>
                    <p>
                        <a class="btn btn-sm btn-outline-info w-100" data-bs-toggle="collapse" href="#collapseReceiving" role="button" aria-expanded="false" aria-controls="collapseReceiving">
                            Receiving Funds
                        </a>
                    </p>
                    <div class="collapse" id="collapseReceiving">
                        <div class="card card-body">
                            <p>To receive funds:</p>
                            <ol>
                                <li>Go to the "Receive" section</li>
                                <li>Copy your VTXO pubkey</li>
                                <li>Share this pubkey with the sender</li>
                            </ol>
                            <p>After receiving funds, they'll appear as "arkoor" type VTXOs. You can refresh them in a round.</p>
                        </div>
                    </div>
                    
                    <p class="mt-2">
                        <a class="btn btn-sm btn-outline-info w-100" data-bs-toggle="collapse" href="#collapseSending" role="button" aria-expanded="false" aria-controls="collapseSending">
                            Sending Payments
                        </a>
                    </p>
                    <div class="collapse" id="collapseSending">
                        <div class="card card-body">
                            <p>To send a payment:</p>
                            <ol>
                                <li>Go to the "Send" section</li>
                                <li>Enter the recipient's VTXO pubkey</li>
                                <li>Enter the amount in sats</li>
                                <li>Click "Send Payment"</li>
                            </ol>
                            <p>After sending, you might receive change as a new VTXO. You can refresh this in a round.</p>
                        </div>
                    </div>
                    
                    <p class="mt-2">
                        <a class="btn btn-sm btn-outline-info w-100" data-bs-toggle="collapse" href="#collapseRefreshing" role="button" aria-expanded="false" aria-controls="collapseRefreshing">
                            Refreshing VTXOs
                        </a>
                    </p>
                    <div class="collapse" id="collapseRefreshing">
                        <div class="card card-body">
                            <p>Refreshing VTXOs in a round provides several benefits:</p>
                            <ul>
                                <li>Changes the type of the VTXO (e.g., from "arkoor" to "round")</li>
                                <li>Extends the expiry time of your VTXOs</li>
                                <li>Consolidates multiple VTXOs into one</li>
                            </ul>
                            <p><strong>Important</strong>: You should refresh your VTXOs before they reach their expiry height. Expired VTXOs cannot be used for spending.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Balance Card -->
            <div class="card">
                <div class="card-header">Balance</div>
                <div class="flex flex-col items-center">
                    <div class="w-full mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-600 dark:text-gray-300">Offchain:</span>
                            <span class="text-xl font-semibold" id="balance-offchain">Loading...</span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-600 dark:text-gray-300">Onchain:</span>
                            <span class="text-xl font-semibold" id="balance-onchain">Loading...</span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-600 dark:text-gray-300">Pending exit:</span>
                            <span class="text-xl font-semibold" id="balance-pending">Loading...</span>
                        </div>
                        <div class="flex justify-between items-center pt-2 border-t dark:border-gray-700">
                            <span class="text-sm font-medium text-gray-600 dark:text-gray-300">Total:</span>
                            <span class="text-2xl font-bold text-ark-orange" id="balance-total">Loading...</span>
                        </div>
                    </div>
                    <button id="refresh-balance-btn" class="btn-secondary text-sm">
                        <i class="bi bi-arrow-repeat"></i> Refresh
                    </button>
                </div>
            </div>

            <!-- Receive Card -->
            <div class="card">
                <div class="card-header">Receive</div>
                <div class="flex flex-col items-center">
                    <p class="text-center mb-4">Your VTXO pubkey:</p>
                    <div class="relative w-full mb-4">
                        <input type="text" id="vtxo-pubkey" class="form-input pr-10" readonly>
                        <button id="copy-pubkey-btn" class="absolute right-2 top-2">
                            <i class="bi bi-clipboard"></i>
                        </button>
                    </div>
                    <p class="text-sm mb-2">You can get free signet sats via <a href="https://signet.2nd.dev" target="_blank" class="text-ark-orange hover:underline">the faucet</a></p>
                    <div class="alert-info text-sm w-full">
                        <i class="bi bi-info-circle"></i> <strong>Tip:</strong> After receiving funds, they'll be of type "arkoor". You can refresh them in a round.
                    </div>
                </div>
            </div>

            <!-- Send Card -->
            <div class="card">
                <div class="card-header">Send</div>
                <form id="payment-form" class="flex flex-col">
                    <label for="recipient" class="mb-1 text-sm font-semibold">Recipient</label>
                    <input type="text" id="recipient" placeholder="VTXO pubkey, Lightning invoice, or Bitcoin address" class="form-input">
                    
                    <label for="amount" class="mb-1 text-sm font-semibold">Amount (sats)</label>
                    <input type="number" id="amount" placeholder="Optional for Lightning invoices" class="form-input">
                    <p class="text-xs text-gray-500 -mt-3 mb-4">Only required for VTXO pubkey or Bitcoin address payments.</p>
                    
                    <button type="submit" class="btn-primary">Send Payment</button>
                </form>
                <div class="alert-info text-sm mt-4">
                    <i class="bi bi-info-circle"></i> <strong>Tip:</strong> After sending a payment, you'll likely receive change as a new VTXO. You can refresh this in a round.
                </div>
                <div class="alert-success text-sm mt-4">
                    <i class="bi bi-shop"></i> <strong>Try it out:</strong> Visit the <a href="https://signet.2nd.dev/store" target="_blank" class="font-bold underline">Ark Test Store</a> to test your payments.
                </div>
            </div>
        </div>

        <!-- VTXOs Card -->
        <div class="card mt-6">
            <div class="card-header">VTXOs</div>
            <div class="flex justify-between items-center mb-4">
                <button id="refresh-vtxos-btn" class="btn-secondary text-sm">
                    <i class="bi bi-arrow-repeat"></i> Refresh List
                </button>
                <button id="vtxo-refresh-btn" class="btn-primary text-sm">
                    <i class="bi bi-lightning"></i> Refresh in Round
                </button>
            </div>
            
            <div class="alert-warning hidden text-sm mb-4" id="vtxo-refresh-alert">
                <i class="bi bi-exclamation-triangle"></i> <strong>Action needed:</strong> You have VTXOs that should be refreshed. Just click the "Refresh in Round" button above to handle this automatically.
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white dark:bg-gray-800 rounded-lg overflow-hidden">
                    <thead class="bg-gray-100 dark:bg-gray-700">
                        <tr>
                            <th class="py-2 px-4 text-left">ID</th>
                            <th class="py-2 px-4 text-left">Amount (sats)</th>
                            <th class="py-2 px-4 text-left">Type</th>
                            <th class="py-2 px-4 text-left">Expiry (Height & Est. Time)</th>
                        </tr>
                    </thead>
                    <tbody id="vtxos-list" class="divide-y divide-gray-200 dark:divide-gray-700">
                        <!-- VTXOs will be added here -->
                    </tbody>
                </table>
            </div>
            
            <div class="alert-info text-sm mt-4">
                <i class="bi bi-info-circle"></i> <strong>About VTXOs:</strong> 
                <p class="mb-1">Since Ark is a new protocol, these terms might be unfamiliar. Here's what they mean:</p>
                <ul class="list-disc pl-5 mb-2">
                    <li><strong>Type "arkoor"</strong>: Created outside rounds</li>
                    <li><strong>Type "round"</strong>: Created in rounds</li>
                    <li><strong>Type "bolt11change"</strong>: Change from a Lightning payment</li>
                </ul>
                <p>Refreshing combines your VTXOs and extends their expiry time.</p>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50"></div>

    <!-- Modals -->
    <div id="actionGuidanceModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white dark:bg-ark-dark rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="border-b p-4">
                <h5 class="text-lg font-semibold" id="actionGuidanceModalTitle">Modal Title</h5>
            </div>
            <div class="p-6" id="actionGuidanceModalBody">
                <!-- Modal content will be added here -->
            </div>
            <div class="border-t p-4 flex justify-end">
                <button class="btn-secondary mr-2" id="actionGuidanceModalClose">Close</button>
                <button class="btn-primary" id="actionGuidanceButton">Action</button>
            </div>
        </div>
    </div>

    <div id="resetWalletModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white dark:bg-ark-dark rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="border-b p-4">
                <h5 class="text-lg font-semibold">Confirm Wallet Reset</h5>
            </div>
            <div class="p-6">
                <div class="alert-danger mb-4">
                    <i class="bi bi-exclamation-triangle-fill"></i> <strong>Warning!</strong> This action cannot be undone.
                </div>
                <p class="mb-2">Are you sure you want to delete this wallet? All your funds and VTXOs will be lost if you haven't backed them up.</p>
                <p>After deletion, a new wallet will be automatically created when you reload the page.</p>
            </div>
            <div class="border-t p-4 flex justify-end">
                <button class="btn-secondary mr-2" id="reset-modal-close">Cancel</button>
                <button class="btn-danger" id="confirm-delete-wallet">Yes, Delete Wallet</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html> 